
SYS=$(shell gcc -dumpmachine)

ifeq (,$(findstring,mingw,$(SYS)))
        STATIC=-static
        LIBRAWFLAGS=-DLIBRAW_NODLL
endif

OBJECTS := util.o elapsedtime.o myEXIFDialog.o myPropertyDialog.o myHistogramPane.o myHistogramDialog.o CurvePane.o PicProcessor.o PicProcessorBlackWhitePoint.o PicProcessorHighlight.o PicProcessorShadow.o PicProcessorCurve.o PicProcessorGamma.o PicProcessorBright.o PicProcessorContrast.o PicProcessorSaturation.o PicProcessorSharpen.o PicProcessorResize.o PicProcessorDenoise.o PicProcessorRotate.o PicProcessorGray.o PicProcessorCrop.o rawprocFrm.o rawprocApp.o PicProcPanel.o PicPanel.o

CXX=@CXX@
LD=@CXX@

LIBS=@LIBS@
CPPFLAGS=@CPPFLAGS@
CXXFLAGS=@CXXFLAGS@
LDFLAGS=@LDFLAGS@
INCLUDEDIRS=@CPPFLAGS@
EXT=@EXEEXT@

srcdir=@srcdir@
VPATH=@srcdir@


all: rawproc img makedoc

rawproc:  $(OBJECTS)
	$(CXX) $(LDFLAGS) $(STATIC) -o rawproc$(EXT) $(OBJECTS)  $(LIBS) 

img: img.o elapsedtime.o
	$(CXX) $(LDFLAGS) $(STATIC) -o img$(EXT) img.o elapsedtime.o $(LIBS)

img.o: $(srcdir)/img.cpp
	$(CXX) $(CXXFLAGS) $(INCLUDEDIRS) -std=c++11 -c $(srcdir)/img.cpp -o$@

elapsedtime.o: $(srcdir)/elapsedtime.cpp
	$(CXX) -c $(srcdir)/elapsedtime.cpp  -o$@

util.o: $(srcdir)/util.cpp
	$(CXX) $(CXXFLAGS) $(INCLUDEDIRS) -c $(srcdir)/util.cpp  -o$@

myPropertyDialog.o: $(srcdir)/myPropertyDialog.cpp
	$(CXX) $(CXXFLAGS) $(INCLUDEDIRS) -c $(srcdir)/myPropertyDialog.cpp  -o$@

myEXIFDialog.o: $(srcdir)/myEXIFDialog.cpp
	$(CXX) $(CXXFLAGS) $(INCLUDEDIRS) -c $(srcdir)/myEXIFDialog.cpp  -o$@

myHistogramPane.o: $(srcdir)/myHistogramPane.cpp
	$(CXX) $(CXXFLAGS) $(INCLUDEDIRS) -c $(srcdir)/myHistogramPane.cpp  -o$@

myHistogramDialog.o: $(srcdir)/myHistogramDialog.cpp
	$(CXX) $(CXXFLAGS) $(INCLUDEDIRS) -c $(srcdir)/myHistogramDialog.cpp  -o$@

CurvePane.o: $(srcdir)/CurvePane.cpp 
	$(CXX) $(CXXFLAGS) $(INCLUDEDIRS) -w -c $(srcdir)/CurvePane.cpp  -o$@

PicProcPanel.o: $(srcdir)/PicProcPanel.cpp
	$(CXX) $(CXXFLAGS) $(INCLUDEDIRS) -c $(srcdir)/PicProcPanel.cpp  -o$@

PicPanel.o: $(srcdir)/PicPanel.cpp
	$(CXX) $(CXXFLAGS) $(INCLUDEDIRS) -c $(srcdir)/PicPanel.cpp  -o$@

PicProcessorBlackWhitePoint.o: $(srcdir)/PicProcessorBlackWhitePoint.cpp
	$(CXX) $(CXXFLAGS) $(INCLUDEDIRS) -c $(srcdir)/PicProcessorBlackWhitePoint.cpp -o$@

PicProcessorHighlight.o: $(srcdir)/PicProcessorHighlight.cpp
	$(CXX) $(CXXFLAGS) $(INCLUDEDIRS) -c $(srcdir)/PicProcessorHighlight.cpp -o$@

PicProcessorShadow.o: $(srcdir)/PicProcessorShadow.cpp
	$(CXX) $(CXXFLAGS) $(INCLUDEDIRS) -c $(srcdir)/PicProcessorShadow.cpp -o$@

PicProcessorCurve.o: $(srcdir)/PicProcessorCurve.cpp
	$(CXX) $(CXXFLAGS) $(INCLUDEDIRS) -c $(srcdir)/PicProcessorCurve.cpp -o$@

PicProcessorGamma.o: $(srcdir)/PicProcessorGamma.cpp
	$(CXX) $(CXXFLAGS) $(INCLUDEDIRS) -c $(srcdir)/PicProcessorGamma.cpp -o$@

PicProcessorBright.o: $(srcdir)/PicProcessorBright.cpp 
	$(CXX) $(CXXFLAGS) $(INCLUDEDIRS) -c $(srcdir)/PicProcessorBright.cpp -o$@

PicProcessorContrast.o: $(srcdir)/PicProcessorContrast.cpp 
	$(CXX) $(CXXFLAGS) $(INCLUDEDIRS) -c $(srcdir)/PicProcessorContrast.cpp -o$@

PicProcessorSaturation.o: $(srcdir)/PicProcessorSaturation.cpp 
	$(CXX) $(CXXFLAGS) $(INCLUDEDIRS) -c $(srcdir)/PicProcessorSaturation.cpp -o$@

PicProcessorGray.o: $(srcdir)/PicProcessorGray.cpp 
	$(CXX) $(CXXFLAGS) $(INCLUDEDIRS) -c $(srcdir)/PicProcessorGray.cpp -o$@

PicProcessorCrop.o: $(srcdir)/PicProcessorCrop.cpp 
	$(CXX) $(CXXFLAGS) $(INCLUDEDIRS) -c $(srcdir)/PicProcessorCrop.cpp -o$@

PicProcessorResize.o: $(srcdir)/PicProcessorResize.cpp 
	$(CXX) $(CXXFLAGS) $(INCLUDEDIRS) -c $(srcdir)/PicProcessorResize.cpp -o$@

PicProcessorSharpen.o: $(srcdir)/PicProcessorSharpen.cpp 
	$(CXX) $(CXXFLAGS) $(INCLUDEDIRS) -c $(srcdir)/PicProcessorSharpen.cpp -o$@

PicProcessorRotate.o: $(srcdir)/PicProcessorRotate.cpp 
	$(CXX) $(CXXFLAGS) $(INCLUDEDIRS) -c $(srcdir)/PicProcessorRotate.cpp -o$@

PicProcessorDenoise.o: $(srcdir)/PicProcessorDenoise.cpp 
	$(CXX) $(CXXFLAGS) $(INCLUDEDIRS) -c $(srcdir)/PicProcessorDenoise.cpp -o$@

PicProcessor.o: $(srcdir)/PicProcessor.cpp
	$(CXX) $(CXXFLAGS) $(INCLUDEDIRS) -c $(srcdir)/PicProcessor.cpp -o$@

rawprocFrm.o: $(srcdir)/rawprocFrm.cpp
	$(CXX) $(CXXFLAGS) $(LIBRAWFLAGS) $(INCLUDEDIRS) -c $(srcdir)/rawprocFrm.cpp -o$@

rawprocApp.o: $(srcdir)/rawprocApp.cpp 
	$(CXX) $(CXXFLAGS) $(INCLUDEDIRS) -c $(srcdir)/rawprocApp.cpp  -o$@

resource.o: $(srcdir)/resource.rc
ifneq (,$(findstring,mingw,$(SYS)))
        windres -c $(srcdir)/resource.rc -o$@
endif

.PHONY: cleanall
cleanall: clean cleandoc

.PHONY: makedoc
makedoc:
	zip  -r -j rawprocdoc.zip $(srcdir)/doc/*

.PHONY: clean
clean:
	rm -f *.o rawproc$(EXT) img$(EXT) 

.PHONY: cleandoc
cleandoc:
	rm -f rawprocdoc.zip



