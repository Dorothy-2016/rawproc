CXX=@CXX@
LD=@CXX@

OBJECTS := util.o elapsedtime.o myConfig.o myEXIFDialog.o myDoubleSlider.o myPropertyDialog.o myHistogramPane.o myHistogramDialog.o CurvePane.o PicProcessor.o PicProcessorBlackWhitePoint.o PicProcessorHighlight.o PicProcessorShadow.o PicProcessorCurve.o PicProcessorGamma.o PicProcessorBright.o PicProcessorContrast.o PicProcessorSaturation.o PicProcessorExposure.o PicProcessorRedEye.o PicProcessorSharpen.o PicProcessorResize.o PicProcessorDenoise.o PicProcessorRotate.o PicProcessorGray.o PicProcessorCrop.o PicProcessorColorSpace.o rawprocFrm.o rawprocApp.o PicProcPanel.o PicPanel.o
LIBOBJECTS := gimage.o jpegimage.o jpegexif.o rawimage.o tiffimage.o pngimage.o strutil.o curve.o

LIBS=@LIBS@
CXXFLAGS=@CXXFLAGS@
CPPFLAGS=@CPPFLAGS@
LDFLAGS=@LDFLAGS@

WX_CPPFLAGS=@WX_CPPFLAGS@
WX_CXXFLAGS_ONLY=@WX_CXXFLAGS_ONLY@
WX_CFLAGS_ONLY=@WX_CFLAGS_ONLY@
WX_LIBS=@WX_LIBS@

BUILDDATE=-DBUILDDATE='"$(shell date)"'
ifdef VERSION
	VERSIONSTR=-DVERSION='"$(VERSION)"'
endif

EXT=@EXEEXT@

srcdir=@srcdir@
VPATH=@srcdir@


all: rawproc img exif

rawproc:  $(OBJECTS) $(LIBOBJECTS)
	$(CXX) $(LDFLAGS) $(STATIC) -o rawproc$(EXT) $(OBJECTS) $(WX_LIBS) $(LIBOBJECTS) $(LIBS) 

img: img.o elapsedtime.o $(LIBOBJECTS)
	$(CXX) $(LDFLAGS) $(STATIC) -o img$(EXT) img.o elapsedtime.o $(LIBOBJECTS) $(LIBS)
	
exif: exif.o $(LIBOBJECTS)
	$(CXX) $(LDFLAGS) $(STATIC) -o exif$(EXT)  exif.o $(LIBOBJECTS) $(LIBS) 


exif.o: $(srcdir)/exif.cpp
	$(CXX) $(VERSIONSTR) $(BUILDDATE) $(CXXFLAGS) $(CPPFLAGS) -c $(srcdir)/exif.cpp -o$@

img.o: $(srcdir)/img.cpp
	$(CXX) $(VERSIONSTR) $(BUILDDATE) $(CXXFLAGS) $(CPPFLAGS) -std=c++11 -c $(srcdir)/img.cpp -o$@

#elapsedtime.o: $(srcdir)/elapsedtime.cpp
#	$(CXX) -c $(srcdir)/elapsedtime.cpp  -o$@

util.o: $(srcdir)/util.cpp
	$(CXX) $(CXXFLAGS) $(CPPFLAGS) $(WX_CPPFLAGS) -c $(srcdir)/util.cpp  -o$@

myPropertyDialog.o: $(srcdir)/myPropertyDialog.cpp
	$(CXX) $(CXXFLAGS) $(CPPFLAGS) $(WX_CPPFLAGS) -c $(srcdir)/myPropertyDialog.cpp  -o$@

myEXIFDialog.o: $(srcdir)/myEXIFDialog.cpp
	$(CXX) $(CXXFLAGS) $(CPPFLAGS) $(WX_CPPFLAGS) -c $(srcdir)/myEXIFDialog.cpp  -o$@
	
myDoubleSlider.o: $(srcdir)/myDoubleSlider.cpp
	$(CXX) $(CXXFLAGS) $(CPPFLAGS) $(WX_CPPFLAGS) -c $(srcdir)/myDoubleSlider.cpp  -o$@

myHistogramPane.o: $(srcdir)/myHistogramPane.cpp
	$(CXX) $(CXXFLAGS) $(CPPFLAGS) $(WX_CPPFLAGS)  -c $(srcdir)/myHistogramPane.cpp  -o$@

myHistogramDialog.o: $(srcdir)/myHistogramDialog.cpp
	$(CXX) $(CXXFLAGS) $(CPPFLAGS) $(WX_CPPFLAGS) -c $(srcdir)/myHistogramDialog.cpp  -o$@

myConfig.o: $(srcdir)/myConfig.cpp
	$(CXX) $(CXXFLAGS) $(CPPFLAGS) $(WX_CPPFLAGS)  -c $(srcdir)/myConfig.cpp  -o$@

CurvePane.o: $(srcdir)/CurvePane.cpp 
	$(CXX) $(CXXFLAGS) $(CPPFLAGS) $(WX_CPPFLAGS) -w -c $(srcdir)/CurvePane.cpp  -o$@

PicProcPanel.o: $(srcdir)/PicProcPanel.cpp
	$(CXX) $(CXXFLAGS) $(CPPFLAGS) $(WX_CPPFLAGS) -c $(srcdir)/PicProcPanel.cpp  -o$@

PicPanel.o: $(srcdir)/PicPanel.cpp
	$(CXX) $(CXXFLAGS) $(CPPFLAGS) $(WX_CPPFLAGS) -c $(srcdir)/PicPanel.cpp  -o$@

PicProcessorBlackWhitePoint.o: $(srcdir)/PicProcessorBlackWhitePoint.cpp
	$(CXX) $(CXXFLAGS) $(CPPFLAGS) $(WX_CPPFLAGS) -c $(srcdir)/PicProcessorBlackWhitePoint.cpp -o$@

PicProcessorHighlight.o: $(srcdir)/PicProcessorHighlight.cpp
	$(CXX) $(CXXFLAGS) $(CPPFLAGS) $(WX_CPPFLAGS)  -c $(srcdir)/PicProcessorHighlight.cpp -o$@

PicProcessorShadow.o: $(srcdir)/PicProcessorShadow.cpp
	$(CXX) $(CXXFLAGS) $(CPPFLAGS) $(WX_CPPFLAGS)  -c $(srcdir)/PicProcessorShadow.cpp -o$@

PicProcessorCurve.o: $(srcdir)/PicProcessorCurve.cpp
	$(CXX) $(CXXFLAGS) $(CPPFLAGS) $(WX_CPPFLAGS)  -c $(srcdir)/PicProcessorCurve.cpp -o$@

PicProcessorGamma.o: $(srcdir)/PicProcessorGamma.cpp
	$(CXX) $(CXXFLAGS) $(CPPFLAGS) $(WX_CPPFLAGS)  -c $(srcdir)/PicProcessorGamma.cpp -o$@

PicProcessorBright.o: $(srcdir)/PicProcessorBright.cpp 
	$(CXX) $(CXXFLAGS) $(CPPFLAGS) $(WX_CPPFLAGS) -c $(srcdir)/PicProcessorBright.cpp -o$@

PicProcessorContrast.o: $(srcdir)/PicProcessorContrast.cpp 
	$(CXX) $(CXXFLAGS) $(CPPFLAGS) $(WX_CPPFLAGS)  -c $(srcdir)/PicProcessorContrast.cpp -o$@

PicProcessorSaturation.o: $(srcdir)/PicProcessorSaturation.cpp 
	$(CXX) $(CXXFLAGS) $(CPPFLAGS) $(WX_CPPFLAGS)  -c $(srcdir)/PicProcessorSaturation.cpp -o$@
	
PicProcessorExposure.o: $(srcdir)/PicProcessorExposure.cpp 
	$(CXX) $(CXXFLAGS) $(CPPFLAGS) $(WX_CPPFLAGS)  -c $(srcdir)/PicProcessorExposure.cpp -o$@
	
PicProcessorRedEye.o: $(srcdir)/PicProcessorRedEye.cpp 
	$(CXX) $(CXXFLAGS) $(CPPFLAGS) $(WX_CPPFLAGS) -c $(srcdir)/PicProcessorRedEye.cpp -o$@

PicProcessorGray.o: $(srcdir)/PicProcessorGray.cpp 
	$(CXX) $(CXXFLAGS) $(CPPFLAGS) $(WX_CPPFLAGS)  -c $(srcdir)/PicProcessorGray.cpp -o$@

PicProcessorCrop.o: $(srcdir)/PicProcessorCrop.cpp 
	$(CXX) $(CXXFLAGS) $(CPPFLAGS) $(WX_CPPFLAGS)  -c $(srcdir)/PicProcessorCrop.cpp -o$@

PicProcessorResize.o: $(srcdir)/PicProcessorResize.cpp 
	$(CXX) $(CXXFLAGS) $(CPPFLAGS) $(WX_CPPFLAGS)  -c $(srcdir)/PicProcessorResize.cpp -o$@

PicProcessorSharpen.o: $(srcdir)/PicProcessorSharpen.cpp 
	$(CXX) $(CXXFLAGS) $(CPPFLAGS) $(WX_CPPFLAGS)  -c $(srcdir)/PicProcessorSharpen.cpp -o$@

PicProcessorRotate.o: $(srcdir)/PicProcessorRotate.cpp 
	$(CXX) $(CXXFLAGS) $(CPPFLAGS) $(WX_CPPFLAGS)  -c $(srcdir)/PicProcessorRotate.cpp -o$@

PicProcessorDenoise.o: $(srcdir)/PicProcessorDenoise.cpp 
	$(CXX) $(CXXFLAGS) $(CPPFLAGS) $(WX_CPPFLAGS)  -c $(srcdir)/PicProcessorDenoise.cpp -o$@
	
PicProcessorColorSpace.o: $(srcdir)/PicProcessorColorSpace.cpp 
	$(CXX) $(CXXFLAGS) $(CPPFLAGS) $(WX_CPPFLAGS)  -c $(srcdir)/PicProcessorColorSpace.cpp -o$@


PicProcessor.o: $(srcdir)/PicProcessor.cpp
	$(CXX) $(CXXFLAGS) $(CPPFLAGS) $(WX_CPPFLAGS)  -c $(srcdir)/PicProcessor.cpp -o$@

rawprocFrm.o: $(srcdir)/rawprocFrm.cpp
	$(CXX) $(VERSIONSTR) $(BUILDDATE) $(CXXFLAGS) $(CPPFLAGS) $(WX_CPPFLAGS) $(LIBRAWFLAGS)  -c $(srcdir)/rawprocFrm.cpp -o$@

rawprocApp.o: $(srcdir)/rawprocApp.cpp 
	$(CXX) $(CXXFLAGS) $(CPPFLAGS) $(WX_CPPFLAGS)  -c $(srcdir)/rawprocApp.cpp  -o$@
	
	
#gimage objects:

gimage.o: $(srcdir)/gimage.cpp
	$(CXX) $(CXXFLAGS) $(CPPFLAGS)  -c $(srcdir)/gimage.cpp -o$@

pngimage.o: $(srcdir)/pngimage.cpp 
	$(CXX) $(CXXFLAGS) $(CPPFLAGS)  -c $(srcdir)/pngimage.cpp -o$@

tiffimage.o: $(srcdir)/tiffimage.cpp 
	$(CXX) $(CXXFLAGS) $(CPPFLAGS)  -c $(srcdir)/tiffimage.cpp -o$@

rawimage.o: $(srcdir)/rawimage.cpp 
	$(CXX) $(CXXFLAGS) $(CPPFLAGS)  -c $(srcdir)/rawimage.cpp -o$@

jpegimage.o: $(srcdir)/jpegimage.cpp 
	$(CXX) $(CXXFLAGS) $(CPPFLAGS)  -c $(srcdir)/jpegimage.cpp -o$@

jpegexif.o: $(srcdir)/jpegexif.cpp 
	$(CXX) $(CXXFLAGS) $(CPPFLAGS)  -c $(srcdir)/jpegexif.cpp -o$@

elapsedtime.o: $(srcdir)/elapsedtime.cpp 
	$(CXX) $(CXXFLAGS) $(CPPFLAGS)  -c $(srcdir)/elapsedtime.cpp -o$@

strutil.o: $(srcdir)/strutil.cpp 
	$(CXX) $(CXXFLAGS) $(CPPFLAGS)  -c $(srcdir)/strutil.cpp -o$@

curve.o: $(srcdir)/curve.cpp 
	$(CXX) $(CXXFLAGS) $(CPPFLAGS)  -c  $(srcdir)/curve.cpp -o$@


resource.o: $(srcdir)/resource.rc
ifneq (,$(findstring,mingw,$(SYS)))
        windres -c $(srcdir)/resource.rc -o$@
endif

.PHONY: cleanall
cleanall: clean cleandoc

.PHONY: makedoc
makedoc:
	zip  -r -j rawprocdoc.zip $(srcdir)/doc/*

.PHONY: clean
clean:
	rm -f *.o rawproc$(EXT) img$(EXT) exif$(EXT)

.PHONY: cleandoc
cleandoc:
	rm -f rawprocdoc.zip

.PHONY: wininstaller
wininstaller:
	$(srcdir)/inno.sh rawproc-@INNO_SUFFIX@-$(VERSION)-install ./rawproc.iss

.PHONY: zip
zip:
ifdef VERSION
	zip "rawproc-@INNO_SUFFIX@-$(VERSION).zip" img.exe ../rawproc.conf rawprocdoc.zip rawproc.exe
else
	zip "rawproc-@INNO_SUFFIX@.zip" img.exe ../rawproc.conf rawprocdoc.zip rawproc.exe
endif

print-%  : ; @echo $* = $($*)





